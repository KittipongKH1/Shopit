<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{base::layout(~{::section})}">

<section th:fragment="section">

    <!-- Search Bar -->
    <div class="container-fluid bg-purple p-4 mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <form action="/products" method="get">
                    <div class="input-group">
                        <input type="text" class="form-control" name="ch" placeholder="Search product...">
                        <button class="btn btn-light text-dark ms-3 col-md-2">
                            <i class="fa-solid fa-magnifying-glass"></i> Search
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container-fluid mt-1">
        <div class="row">

            <!-- Sidebar: Categories -->
            <div class="col-md-2 p-0">
                <div class="card shadow-sm mb-5 bg-body-tertiary rounded">
                    <div class="card-body">
                        <p class="fs-5">Category</p>
                        <div class="list-group">
                            <a href="/products"
                               th:classappend="${paramValue==''} ? ' active-category':''"
                               class="list-group-item list-group-item-action">All</a>
                            <a th:each="c:${categories}" 
                               th:href="@{'/products?category='+${c.name}}"
                               th:classappend="${paramValue==c.name} ? ' active-category':''"
                               class="list-group-item list-group-item-action">[[${c.name}]]</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Products Grid -->
            <div class="col-md-10">
                <div class="card">
                    <div class="card-body">
                        <p class="fs-3 text-center">Products</p>
                        <div class="row g-3">

                            <!-- Product Cards -->
                            <th:block th:if="${productsSize > 0}">
                                <div class="col-sm-6 col-md-4 col-lg-3" th:each="p:${products}">
                                    <div class="card shadow-sm h-100">
                                        <div class="card-body text-center d-flex flex-column">
                                            <img th:src="@{'/img/product_img/'+${p.image}}" class="img-fluid mb-2" style="max-height:150px;" alt="Product">

                                            <!-- Product Title Gradient -->
                                            <p class="fs-5 flex-grow-1 product-title-gradient">[[${p.title}]]</p>

                                            <p class="fs-6 fw-bold">
    ฿ [[${T(java.lang.String).format('%.2f', p.price * (100 - p.discount) / 100.0)}]]
    <span class="text-decoration-line-through text-secondary" th:if="${p.discount>0}">
        ฿ [[${T(java.lang.String).format('%.2f', p.price)}]]
    </span>
    <span class="text-success" th:if="${p.discount>0}">
        [[${p.discount}]]% off
    </span>
</p>

</p>


                                            <a th:href="@{'/product/'+${p.id}}" class="btn btn-purple mt-auto">View Details</a>
                                        </div>
                                    </div>
                                </div>
                            </th:block>

                            <!-- No Products Message -->
                            <th:block th:unless="${productsSize > 0}">
                                <p class="fs-4 text-center mt-4 text-danger">Product not available</p>
                            </th:block>

                        </div>
                    </div>
                </div>

                <!-- Pagination -->
                <div class="row mt-3 align-items-center">
                    <div class="col-md-4">Total Products: [[${totalElements}]]</div>
                    <div class="col-md-6">
                        <th:block th:if="${productsSize > 0}">
                            <nav>
                                <ul class="pagination">
                                    <li class="page-item" th:classappend="${isFirst} ? 'disabled':''">
                                        <a class="page-link" th:href="@{'/products?pageNo='+${pageNo-1}}">&laquo;</a>
                                    </li>
                                    <li th:each="i:${#numbers.sequence(1,totalPages)}" class="page-item"
                                        th:classappend="${pageNo+1==i} ? 'active':''">
                                        <a class="page-link" th:href="@{'/products?pageNo='+${i-1}}">[[${i}]]</a>
                                    </li>
                                    <li class="page-item" th:classappend="${isLast} ? 'disabled':''">
                                        <a class="page-link" th:href="@{'/products?pageNo='+${pageNo+1}}">&raquo;</a>
                                    </li>
                                </ul>
                            </nav>
                        </th:block>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Custom CSS for Purple Theme + Gradient Titles -->
    <style>
        /* Sidebar active category */
.active-category {
    background-color: #6f42c1 !important; /* base purple */
    color: #fff !important;
    font-weight: bold;
}

.list-group-item-action:hover {
    background-color: #5a32a3 !important; /* darker purple on hover */
    color: #fff !important;
}

/* Buttons */
.btn-purple {
    background-color: #6f42c1;
    color: #fff;
    border: none;
}

.btn-purple:hover {
    background-color: #5a32a3;
    color: #fff;
}

/* Search Bar background */
.bg-purple {
    background-color: #6f42c1 !important;
    color: #fff;
}

/* Gradient for product title only */
.product-title-gradient {
    font-weight: 800;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

    </style>

</section>
</html>
